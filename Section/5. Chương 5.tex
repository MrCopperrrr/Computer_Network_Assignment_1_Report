\part*{Chương 5: Kiểm thử và kết quả}
\addcontentsline{toc}{part}{Chương 5: Kiểm thử và kết quả}
%============================================================================

\section*{5.1. Kịch bản và Môi trường kiểm thử}
\addcontentsline{toc}{section}{5.1. Kịch bản và Môi trường kiểm thử}
\begin{itemize}
    \item \textbf{Môi trường: }Các kịch bản được thực hiện trên một máy tính duy nhất chạy hệ điều hành Windows, mô phỏng một môi trường mạng cục bộ (LAN). Các tiến trình server và client được khởi chạy trên các cửa sổ dòng lệnh (PowerShell) riêng biệt. Giao diện người dùng được truy cập thông qua trình duyệt web ở chế độ ẩn danh để đảm bảo không bị ảnh hưởng bởi cache.
    \item \textbf{Địa chỉ IP: }
    \begin{itemize}
        \item Tracker Server chạy trên \texttt{0.0.0.0:8001}.
        \item Các Peer Client kết nối đến Tracker Server qua địa chỉ \texttt{127.0.0.1:8001}.
        \item Địa chỉ P2P được các Peer Client đăng ký với Tracker là địa chỉ IP cục bộ của máy (ví dụ: \texttt{192.168.1.6}).
    \end{itemize}
\end{itemize}
%============================================================================
\section*{5.2. Kết quả thực nghiệm}
\addcontentsline{toc}{section}{5.2. Kết quả thực nghiệm}
\subsection*{5.2.1. Kiểm thử HTTP Server và Cookie Session bằng giao diện UI/UX}
Kịch bản này nhằm kiểm tra khả năng xử lý \textbf{HTTP request}, \textbf{xác thực}, và \textbf{quản lý phiên bằng cookie} của máy chủ HTTP được tự xây dựng từ đầu.
\subsubsection*{Bước 1: Khởi chạy các Server}

\begin{itemize}

    \item \textbf{Mở Terminal 1}, khởi chạy \textit{Backend Server}:
    \begin{lstlisting}[language=bash]
python start_backend.py --server-ip <local-ip> --server-port 9000
    \end{lstlisting}
    \item \textbf{Kết quả: }Log từ PowerShell
    \begin{lstlisting}[language=bash]
[Backend] Listening on port 9000    
    \end{lstlisting}
    \item \textbf{Mở Terminal 2}, khởi chạy \textit{Proxy Server}:
    \begin{lstlisting}[language=bash]
python start_proxy.py --server-ip 0.0.0.0 --server-port 8080
    \end{lstlisting}
    \item \textbf{Kết quả: }Log từ PowerShell
    \begin{lstlisting}[language=bash]
[Host] 192.168.1.6:8080
[PORT] 192.168.1.6:9000
[POLICY] round-robin
[Proxy] Listening on IP 0.0.0.0 port 8080    
    \end{lstlisting}
\end{itemize}

\subsubsection*{Bước 2: Kiểm thử luồng xác thực trên trình duyệt}

\begin{itemize}
    \item Mở trình duyệt ở chế độ ẩn danh, truy cập địa chỉ:
    \begin{center}
        \texttt{http://<local-ip>:8080/}
    \end{center}
    \textbf{Kết quả:} Trang web trả về lỗi \texttt{401 Unauthorized} vì chưa có cookie xác thực.
    \begin{figure}[H]
    \centering
    \setlength{\fboxsep}{2pt}     
    \setlength{\fboxrule}{0.5pt}   
    \fbox{\includegraphics[scale=0.4]{Picture/401.png}}
    \caption{Giao diện trang web trả về lỗi 401 Unauthorized}
    \end{figure}

    \item Truy cập trang đăng nhập:
    \begin{center}
        \texttt{http://<local-ip>:8080/login.html}
    \end{center}
    \textbf{Kết quả:} Form đăng nhập hiển thị chính xác.
    \begin{figure}[H]
    \centering
    \setlength{\fboxsep}{2pt}     
    \setlength{\fboxrule}{0.5pt}   
    \fbox{\includegraphics[scale=0.4]{Picture/login.png}}
    \caption{Giao diện trang web hiển thị form đăng nhập}
    \end{figure}

    \item Nhập thông tin:
    \begin{center}
        \texttt{username = admin}, \quad \texttt{password = password}
    \end{center}
    Sau đó gửi form.

    \textbf{Kết quả:}
    \begin{itemize}
        \item Đăng nhập thành công, trình duyệt được chuyển hướng đến \texttt{index.html}.
        \item Trong Developer Tools (F12), một cookie \texttt{auth=true} được thiết lập.
    \end{itemize}
    \begin{figure}[H]
    \centering
    \setlength{\fboxsep}{2pt}     
    \setlength{\fboxrule}{0.5pt}   
    \fbox{\includegraphics[scale=0.4]{Picture/loginok.png}}
    \caption{Giao diện trang web sau khi đăng nhập thành công và có cookie cho phiên đăng nhập}
    \end{figure}

    \item Truy cập lại \texttt{http://<local-ip>:8080/}.

    \textbf{Kết quả:} Trang \texttt{index.html} được hiển thị vì trình duyệt đã gửi kèm cookie hợp lệ.
    \begin{figure}[H]
        \centering
        \setlength{\fboxsep}{2pt}     
        \setlength{\fboxrule}{0.5pt}   
        \fbox{\includegraphics[scale=0.4]{Picture/loginok.png}}
        \caption{Giao diện trang web sau khi reload lại}
    \end{figure}
\end{itemize}


\subsubsection*{Kết luận:}  
Chức năng xử lý request, xác thực đăng nhập và quản lý phiên bằng cookie hoạt động chính xác theo thiết kế. Hệ thống có thể phục vụ nhiều client đồng thời và duy trì phiên làm việc ổn định.

% -------------------------------------------------------------
\subsection*{5.2.2. Kiểm thử HTTP Server và Cookie Session bằng phần mềm Postman}
Sử dụng ứng dụng Postman Desktop để kiểm tra luồng xác thực cookie.
\subsubsection*{Bước 1: Khởi chạy các Server}
\begin{itemize}
    \item \textbf{Mở Terminal 1}, khởi chạy \textit{Backend Server}:
    \begin{lstlisting}[language=bash]
python start_backend.py --server-ip <local-ip> --server-port 9000
    \end{lstlisting}
    \item \textbf{Kết quả: }Log từ PowerShell
    \begin{lstlisting}[language=bash]
[Backend] Listening on port 9000    
    \end{lstlisting}
    \item \textbf{Mở Terminal 2}, khởi chạy \textit{Proxy Server}:
    \begin{lstlisting}[language=bash]
python start_proxy.py --server-ip 0.0.0.0 --server-port 8080
    \end{lstlisting}
    \item \textbf{Kết quả: }Log từ PowerShell
    \begin{lstlisting}[language=bash]
[Host] 192.168.1.6:8080
[PORT] 192.168.1.6:9000
[POLICY] round-robin
[Proxy] Listening on IP 0.0.0.0 port 8080    
    \end{lstlisting}
\end{itemize}

\subsubsection*{Bước 2: Kiểm tra bằng cách gọi các API}
\begin{itemize}
    \item \textbf{Truy cập vào trang được bảo vệ (không Cookie):}
    \begin{itemize}
        \item \textbf{Phương thức: }GET
        \item \textbf{URL: } http://<local-ip>:8080/
        \item Nhấn \textbf{Send}
        \item \textbf{Kết quả: }Status code \texttt{401 Unauthorized}
    \begin{figure}[H]
        \centering
        \setlength{\fboxsep}{2pt}     
        \setlength{\fboxrule}{0.5pt}   
        \fbox{\includegraphics[scale=0.5]{Picture/401PM.png}}
        \caption{Giao diện Postman khi truy cập trang web được bảo vệ mà không có cookie}
    \end{figure}
    \end{itemize}

    \item \textbf{Đăng nhập để nhận được Cookie:}
    \begin{itemize}
        \item \textbf{Phương thức: }POST
        \item \textbf{URL: } http://<local-ip>:8080/login
        \item Chuyển sang tab \textbf{Body} và chọn \texttt{x-www-form-urlencoded}
        \item Nhập các cặp key-value sau:
        \begin{verbatim}
            `username`: `admin`
            `password`: `password`
        \end{verbatim}
        \item Nhấn \textbf{Send}
        \item \textbf{Kết quả: }Status code \texttt{200 OK}. Trong tab \texttt{Cookie} của Response, sẽ thấy Cookie \texttt{auth=true}. Postman sẽ tự động lưu và sử dụng cookie này cho các request tiếp theo đến ip này.
    \begin{figure}[H]
        \centering
        \setlength{\fboxsep}{2pt}     
        \setlength{\fboxrule}{0.5pt}   
        \fbox{\includegraphics[scale=0.5]{Picture/loginokPM.png}}
        \caption{Giao diện Postman khi truy cập trang web thành công}
    \end{figure}
    \begin{figure}[H]
        \centering
        \setlength{\fboxsep}{2pt}     
        \setlength{\fboxrule}{0.5pt}   
        \fbox{\includegraphics[scale=0.5]{Picture/loginokcookiePM.png}}
        \caption{Giao diện Postman khi truy cập thành công cookie đã thiết lập }
    \end{figure}
    \end{itemize}

    \item \textbf{Truy cập vào trang được bảo vệ (có Cookie):}
    \begin{itemize}
        \item \textbf{Phương thức: }GET
        \item \textbf{URL: } http://<local-ip>:8080/
        \item Nhấn \textbf{Send}
        \item \textbf{Kết quả: }Status code \texttt{200 OK}. Body của response sẽ chứa nội dung của trang \texttt{index.htm}
    \begin{figure}[H]
        \centering
        \setlength{\fboxsep}{2pt}     
        \setlength{\fboxrule}{0.5pt}   
        \fbox{\includegraphics[scale=0.5]{Picture/reloadPM.png}}
        \caption{Giao diện Postman khi truy cập trang web được bảo vệ có cookie}
    \end{figure}
    \end{itemize}
\end{itemize}


% -------------------------------------------------------------
\subsection*{5.2.3. Kiểm thử Ứng dụng Chat Hybrid}

Kịch bản này kiểm thử toàn bộ luồng hoạt động của \textbf{ứng dụng chat hybrid}, từ quá trình khám phá peer đến giao tiếp \textbf{P2P (Peer-to-Peer)} và quản lý session phía client.

\subsubsection*{Bước 1: Khởi chạy Tracker Server}

\begin{lstlisting}[language=bash]
python start_chatapp.py --server-ip 0.0.0.0 --server-port 8001
\end{lstlisting}

\textbf{Kết quả:} Server khởi động thành công và lắng nghe trên port 8001.

\subsubsection*{Bước 2: Khởi chạy các Peer Client}

\begin{enumerate}[label=--]
    \item \textbf{Mở Terminal 2}, khởi chạy client cho người dùng \texttt{alice}:
    \begin{lstlisting}[language=bash]
py peer_client.py --username alice --peer-port 9101
    \end{lstlisting}

    \item \textbf{Mở Terminal 3}, khởi chạy client cho người dùng \texttt{bob}:
    \begin{lstlisting}[language=bash]
py peer_client.py --username bob --peer-port 9102
    \end{lstlisting}

    \textbf{Kết quả:}
    \begin{itemize}
        \item Mỗi client khởi động thành công.
        \item Mỗi client chạy \textbf{3 server} riêng biệt: P2P, HTTP và WebSocket.
        \item Các client tự động đăng ký với \texttt{Tracker Server}.
    \end{itemize}
\end{enumerate}

\subsubsection*{Bước 3: Kiểm thử Giao diện và Giao tiếp}

\begin{enumerate}[label=--]
    \item Mở hai cửa sổ trình duyệt ẩn danh riêng biệt cho Alice và Bob.
    \item Truy cập các URL tương ứng được in ra terminal, ví dụ:
    \begin{center}
        \texttt{http://localhost:19101/www/chat.html} \quad (Alice)
    \end{center}
    \item Thực hiện đăng nhập cho cả hai người dùng.
\end{enumerate}

\textbf{Kết quả:}
\begin{itemize}
    \item Cả hai đăng nhập thành công và tự động tham gia vào các kênh \texttt{\#general} và \texttt{\#broadcast}.
    \item Giao diện chat chính được hiển thị đúng bố cục.
\end{itemize}

\subsubsection*{Kiểm thử Chat Nhóm (Kênh \#general)}

\begin{itemize}
    \item Trên giao diện của Alice, chọn kênh \texttt{\#general} và gửi một tin nhắn.
    \item \textbf{Kết quả:} Tin nhắn của Alice hiển thị đồng thời trên giao diện của Alice và Bob (vì cả hai cùng trong kênh).
\end{itemize}

\subsubsection*{Kiểm thử Chat Riêng (P2P)}

\begin{itemize}
    \item Trên giao diện của Alice, chuyển sang tab \texttt{Peers}, danh sách hiển thị \texttt{bob}.
    \item Chọn \texttt{bob} để mở cửa sổ chat riêng và gửi tin nhắn.
    \item \textbf{Kết quả:} Giao diện của Bob hiển thị chấm thông báo bên cạnh tên \texttt{alice}. Khi Bob mở cửa sổ chat, lịch sử tin nhắn được hiển thị đầy đủ.
\end{itemize}

\subsubsection*{Kiểm thử Broadcast}

\begin{itemize}
    \item Trên giao diện của Alice, chọn kênh \texttt{\#broadcast} và gửi tin nhắn.
    \item \textbf{Kết quả:} Tin nhắn xuất hiện ngay trên cửa sổ chat của Bob, bất kể Bob đang ở kênh hay cuộc trò chuyện nào.
\end{itemize}

\subsubsection*{Kiểm thử Duy trì Session}

\begin{itemize}
    \item Nhấn F5 để tải lại trang của Alice.
    \item \textbf{Kết quả:} Trang web tự động quay lại giao diện chat mà không cần đăng nhập lại, nhờ thông tin lưu trong \texttt{localStorage}. Cookie ``trình diễn'' vẫn còn hiệu lực.
\end{itemize}

\subsubsection*{Kết quả thực nghiệm}

% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.9\textwidth]{images/chat_p2p_demo.png}
%     \caption{Giao diện của Alice và Bob trong phiên chat P2P.}
% \end{figure}

% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.85\textwidth]{images/cookie_localstorage_demo.png}
%     \caption{Cookie và LocalStorage được thiết lập trong Developer Tools.}
% \end{figure}

\subsubsection*{Kết luận:}  
Toàn bộ luồng hoạt động của ứng dụng chat hybrid — bao gồm khám phá, giao tiếp P2P, chat nhóm, broadcast và duy trì session — đều hoạt động ổn định, đúng với yêu cầu của đề tài. Hệ thống chứng minh tính tích hợp hoàn chỉnh giữa các thành phần HTTP, WebSocket, và P2P.
